<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AuIrphila Bakery</title>
    <link rel="stylesheet" href="../css/login.css">
    <link rel="stylesheet" href="../css/admin-dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="../js/api.js"></script>
        <script src="../js/auth.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="home-link">
        <a href="../index.html"><i class="fas fa-home"></i> Back to Home</a>
    </div>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>Admin Dashboard</h1>
            <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>

        <div class="dashboard-content">
            <!-- Sales Summary Card -->
            <div class="dashboard-card">
                <h2><i class="fas fa-chart-line"></i> Sales Summary</h2>
                <div class="summary-card">
                    <div class="icon"><i class="fas fa-dollar-sign"></i></div>
                    <div class="info">
                        <div class="value" id="today-sales">$78.49</div>
                        <div class="label">Today's Sales</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon"><i class="fas fa-calendar-week"></i></div>
                    <div class="info">
                        <div class="value">$325.75</div>
                        <div class="label">Weekly Sales</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                    <div class="info">
                        <div class="value">$1,245.50</div>
                        <div class="label">Monthly Sales</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon"><i class="fas fa-shopping-cart"></i></div>
                    <div class="info">
                        <div class="value" id="today-orders">2</div>
                        <div class="label">Orders Today</div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats Card -->
            <div class="dashboard-card">
                <h2><i class="fas fa-tachometer-alt"></i> Quick Stats</h2>
                <div class="summary-card">
                    <div class="icon"><i class="fas fa-users"></i></div>
                    <div class="info">
                        <div class="value" id="total-users">24</div>
                        <div class="label">Total Users</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon"><i class="fas fa-shopping-bag"></i></div>
                    <div class="info">
                        <div class="value" id="total-orders">8</div>
                        <div class="label">Total Orders</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon"><i class="fas fa-birthday-cake"></i></div>
                    <div class="info">
                        <div class="value" id="total-products">48</div>
                        <div class="label">Total Products</div>
                    </div>
                </div>
                <div class="summary-card notification-badge">
                    <div class="icon"><i class="fas fa-envelope"></i></div>
                    <div class="info">
                        <div class="value" id="contact-submissions">12</div>
                        <div class="label">Contact Submissions</div>
                    </div>
                </div>
            </div>

            <!-- Popular Products Card -->
            <div class="dashboard-card popular-products">
                <h2><i class="fas fa-star"></i> Popular Products</h2>
                <ul id="popular-products">
                    <li>Chocolate Cake - 42 sold</li>
                    <li>Sourdough Bread - 38 sold</li>
                    <li>Blueberry Muffin - 35 sold</li>
                    <li>Almond Croissant - 29 sold</li>
                </ul>
            </div>

            <!-- Order Management Card -->
            <div class="dashboard-card full-width">
                <h2><i class="fas fa-tasks"></i> Order Management</h2>
                
                <div class="tabs">
                    <button class="tab active" data-tab="all-orders">All Orders</button>
                    <button class="tab" data-tab="pending-orders">Pending</button>
                    <button class="tab" data-tab="processing-orders">Processing</button>
                    <button class="tab" data-tab="completed-orders">Completed</button>
                    <button class="tab" data-tab="cancelled-orders">Cancelled</button>
                </div>
                
                <!-- All Orders Tab -->
                <div class="tab-content active" id="all-orders">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="all-orders-data">
                            <!-- Order data will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pending Orders Tab -->
                <div class="tab-content" id="pending-orders">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pending-orders-data">
                            <!-- Pending order data will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Processing Orders Tab -->
                <div class="tab-content" id="processing-orders">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="processing-orders-data">
                            <!-- Processing order data will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Completed Orders Tab -->
                <div class="tab-content" id="completed-orders">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="completed-orders-data">
                            <!-- Completed order data will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Cancelled Orders Tab -->
                <div class="tab-content" id="cancelled-orders">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="cancelled-orders-data">
                            <!-- Cancelled order data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Sales Overview Card -->
            <div class="dashboard-card full-width">
                <h2><i class="fas fa-chart-bar"></i> Sales Overview</h2>
                <div class="sales-chart" id="sales-chart">
                    <!-- Chart will be rendered here -->
                    <div class="loading"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                // Show corresponding tab content
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });
        
        // Load mock order data
        function loadMockOrderData() {
            const orders = [
                { id: 'ORD-001', customer: 'John Doe', date: '2023-06-15', total: 45.99, status: 'completed' },
                { id: 'ORD-002', customer: 'Jane Smith', date: '2023-06-15', total: 32.50, status: 'pending' },
                { id: 'ORD-003', customer: 'Robert Johnson', date: '2023-06-14', total: 78.25, status: 'processing' },
                { id: 'ORD-004', customer: 'Emily Davis', date: '2023-06-14', total: 19.99, status: 'completed' },
                { id: 'ORD-005', customer: 'Michael Brown', date: '2023-06-13', total: 65.75, status: 'cancelled' },
                { id: 'ORD-006', customer: 'Sarah Wilson', date: '2023-06-13', total: 42.30, status: 'pending' },
                { id: 'ORD-007', customer: 'David Miller', date: '2023-06-12', total: 55.00, status: 'completed' },
                { id: 'ORD-008', customer: 'Lisa Taylor', date: '2023-06-12', total: 29.99, status: 'processing' }
            ];
            
            // Populate all orders table
            let allOrdersHTML = '';
            orders.forEach(order => {
                let statusClass = '';
                switch(order.status) {
                    case 'pending':
                        statusClass = 'status-pending';
                        break;
                    case 'processing':
                        statusClass = 'status-processing';
                        break;
                    case 'completed':
                        statusClass = 'status-completed';
                        break;
                    case 'cancelled':
                        statusClass = 'status-cancelled';
                        break;
                }
                
                allOrdersHTML += `
                    <tr>
                        <td>${order.id}</td>
                        <td>${order.customer}</td>
                        <td>${order.date}</td>
                        <td>$${order.total.toFixed(2)}</td>
                        <td><span class="order-status ${statusClass}">${order.status}</span></td>
                        <td>
                            <button class="action-btn view-btn" onclick="viewOrder('${order.id}')"><i class="fas fa-eye"></i></button>
                            <button class="action-btn edit-btn" onclick="editOrder('${order.id}')"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn" onclick="deleteOrder('${order.id}')"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('all-orders-data').innerHTML = allOrdersHTML;
            
            // Populate filtered order tables
            populateFilteredOrders('pending', orders);
            populateFilteredOrders('processing', orders);
            populateFilteredOrders('completed', orders);
            populateFilteredOrders('cancelled', orders);
            
            // Simulate chart loading
            setTimeout(() => {
                document.getElementById('sales-chart').innerHTML = `
                    <img src="https://via.placeholder.com/800x300?text=Sales+Chart+Placeholder" alt="Sales Chart" style="max-width: 100%; border-radius: 8px;">
                `;
            }, 1500);
        }
        
        // Function to populate filtered order tables
        function populateFilteredOrders(status, orders) {
            const filteredOrders = orders.filter(order => order.status === status);
            let html = '';
            
            if (filteredOrders.length === 0) {
                html = `<tr><td colspan="5">No ${status} orders found.</td></tr>`;
            } else {
                filteredOrders.forEach(order => {
                    html += `
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.customer}</td>
                            <td>${order.date}</td>
                            <td>$${order.total.toFixed(2)}</td>
                            <td>
                                <button class="action-btn view-btn" onclick="viewOrder('${order.id}')"><i class="fas fa-eye"></i></button>
                                <button class="action-btn edit-btn" onclick="editOrder('${order.id}')"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" onclick="deleteOrder('${order.id}')"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            document.getElementById(`${status}-orders-data`).innerHTML = html;
        }
        
        // Function to load order data from API
        async function loadOrderData() {
            try {
                const orders = await orderAPI.getAllOrders();
                
                // Calculate totals for summary
                const today = new Date().toISOString().split('T')[0];
                let todaySales = 0;
                let todayOrders = 0;
                
                orders.forEach(order => {
                    if (order.date === today) {
                        todaySales += parseFloat(order.total);
                        todayOrders++;
                    }
                });
                
                // Update summary data
                document.getElementById('today-sales').textContent = '$' + todaySales.toFixed(2);
                document.getElementById('total-orders').textContent = orders.length;
                document.getElementById('today-orders').textContent = todayOrders;
                
                // Populate tables
                let allOrdersHTML = '';
                orders.forEach(order => {
                    let statusClass = '';
                    switch(order.status) {
                        case 'pending':
                            statusClass = 'status-pending';
                            break;
                        case 'processing':
                            statusClass = 'status-processing';
                            break;
                        case 'completed':
                            statusClass = 'status-completed';
                            break;
                        case 'cancelled':
                            statusClass = 'status-cancelled';
                            break;
                    }
                    
                    allOrdersHTML += `
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.customer}</td>
                            <td>${order.date}</td>
                            <td>$${order.total.toFixed(2)}</td>
                            <td><span class="order-status ${statusClass}">${order.status}</span></td>
                            <td>
                                <button class="action-btn view-btn" onclick="viewOrder('${order.id}')"><i class="fas fa-eye"></i></button>
                                <button class="action-btn edit-btn" onclick="editOrder('${order.id}')"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" onclick="deleteOrder('${order.id}')"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    `;
                });
                document.getElementById('all-orders-data').innerHTML = allOrdersHTML;
                
                // Populate filtered order tables
                populateFilteredOrders('pending', orders);
                populateFilteredOrders('processing', orders);
                populateFilteredOrders('completed', orders);
                populateFilteredOrders('cancelled', orders);
                
            } catch (error) {
                console.error('Error loading order data:', error);
                // Fall back to mock data if API fails
                loadMockOrderData();
            }
        }
        
        // Order action functions
        function viewOrder(orderId) {
            alert(`Viewing order ${orderId}`);
        }
        
        function editOrder(orderId) {
            alert(`Editing order ${orderId}`);
        }
        
        function deleteOrder(orderId) {
            if (confirm(`Are you sure you want to delete order ${orderId}?`)) {
                alert(`Order ${orderId} deleted`);
            }
        }
        
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '../index.html';
            }
        });
        
        // Add animation to cards on scroll
        function animateOnScroll() {
            const cards = document.querySelectorAll('.dashboard-card');
            
            cards.forEach(card => {
                const cardPosition = card.getBoundingClientRect().top;
                const screenPosition = window.innerHeight / 1.3;
                
                if (cardPosition < screenPosition) {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadOrderData();
            
            // Add scroll animation
            window.addEventListener('scroll', animateOnScroll);
            animateOnScroll(); // Initial check
        });
    </script>
    <script src="../js/auth-check.js" type="module"></script>
</body>
</html>